import{encode}from"sourcemap-codec";var Chunk=function(t,n,e){this.start=t,this.end=n,this.original=e,this.intro="",this.outro="",this.content=e,this.storeName=!1,this.edited=!1,Object.defineProperties(this,{previous:{writable:!0,value:null},next:{writable:!0,value:null}})};Chunk.prototype.appendLeft=function(t){this.outro+=t},Chunk.prototype.appendRight=function(t){this.intro=this.intro+t},Chunk.prototype.clone=function(){var t=new Chunk(this.start,this.end,this.original);return t.intro=this.intro,t.outro=this.outro,t.content=this.content,t.storeName=this.storeName,t.edited=this.edited,t},Chunk.prototype.contains=function(t){return this.start<t&&t<this.end},Chunk.prototype.eachNext=function(t){for(var n=this;n;)t(n),n=n.next},Chunk.prototype.eachPrevious=function(t){for(var n=this;n;)t(n),n=n.previous},Chunk.prototype.edit=function(t,n,e){return this.content=t,e||(this.intro="",this.outro=""),this.storeName=n,this.edited=!0,this},Chunk.prototype.prependLeft=function(t){this.outro=t+this.outro},Chunk.prototype.prependRight=function(t){this.intro=t+this.intro},Chunk.prototype.split=function(t){var n=t-this.start,e=this.original.slice(0,n),i=this.original.slice(n);this.original=e;var r=new Chunk(t,this.end,i);return r.outro=this.outro,this.outro="",this.end=t,this.edited?(r.edit("",!1),this.content=""):this.content=e,r.next=this.next,r.next&&(r.next.previous=r),r.previous=this,this.next=r,r},Chunk.prototype.toString=function(){return this.intro+this.content+this.outro},Chunk.prototype.trimEnd=function(t){if(this.outro=this.outro.replace(t,""),this.outro.length)return!0;var n=this.content.replace(t,"");return n.length?(n!==this.content&&this.split(this.start+n.length).edit("",void 0,!0),!0):(this.edit("",void 0,!0),this.intro=this.intro.replace(t,""),!!this.intro.length||void 0)},Chunk.prototype.trimStart=function(t){if(this.intro=this.intro.replace(t,""),this.intro.length)return!0;var n=this.content.replace(t,"");return n.length?(n!==this.content&&(this.split(this.end-n.length),this.edit("",void 0,!0)),!0):(this.edit("",void 0,!0),this.outro=this.outro.replace(t,""),!!this.outro.length||void 0)};var btoa=function(){throw new Error("Unsupported environment: `window.btoa` or `Buffer` should be supported.")};"undefined"!=typeof window&&"function"==typeof window.btoa?btoa=window.btoa:"function"==typeof Buffer&&(btoa=function(t){return new Buffer(t).toString("base64")});var SourceMap=function(t){this.version=3,this.file=t.file,this.sources=t.sources,this.sourcesContent=t.sourcesContent,this.names=t.names,this.mappings=encode(t.mappings)};function guessIndent(t){var n=t.split("\n"),e=n.filter(function(t){return/^\t+/.test(t)}),i=n.filter(function(t){return/^ {2,}/.test(t)});if(0===e.length&&0===i.length)return null;if(e.length>=i.length)return"\t";var r=i.reduce(function(t,n){var e=/^ +/.exec(n)[0].length;return Math.min(e,t)},1/0);return new Array(r+1).join(" ")}function getRelativePath(t,n){var e=t.split(/[\/\\]/),i=n.split(/[\/\\]/);for(e.pop();e[0]===i[0];)e.shift(),i.shift();if(e.length)for(var r=e.length;r--;)e[r]="..";return e.concat(i).join("/")}SourceMap.prototype.toString=function(){return JSON.stringify(this)},SourceMap.prototype.toUrl=function(){return"data:application/json;charset=utf-8;base64,"+btoa(this.toString())};var toString=Object.prototype.toString;function isObject(t){return"[object Object]"===toString.call(t)}function getLocator(t){for(var n=t.split("\n"),e=[],i=0,r=0;i<n.length;i++)e.push(r),r+=n[i].length+1;return function(t){for(var n=0,i=e.length;n<i;){var r=n+i>>1;t<e[r]?i=r:n=r+1}var o=n-1;return{line:o,column:t-e[o]}}}var Mappings=function(t){this.hires=t,this.generatedCodeLine=0,this.generatedCodeColumn=0,this.raw=[],this.rawSegments=this.raw[this.generatedCodeLine]=[],this.pending=null};Mappings.prototype.addEdit=function(t,n,e,i){if(n.length){var r=[this.generatedCodeColumn,t,e.line,e.column];i>=0&&r.push(i),this.rawSegments.push(r)}else this.pending&&this.rawSegments.push(this.pending);this.advance(n),this.pending=null},Mappings.prototype.addUneditedChunk=function(t,n,e,i,r){for(var o=n.start,s=!0;o<n.end;)(this.hires||s||r[o])&&this.rawSegments.push([this.generatedCodeColumn,t,i.line,i.column]),"\n"===e[o]?(i.line+=1,i.column=0,this.generatedCodeLine+=1,this.raw[this.generatedCodeLine]=this.rawSegments=[],this.generatedCodeColumn=0):(i.column+=1,this.generatedCodeColumn+=1),o+=1,s=!1;this.pending=[this.generatedCodeColumn,t,i.line,i.column]},Mappings.prototype.advance=function(t){if(t){var n=t.split("\n");if(n.length>1){for(var e=0;e<n.length-1;e++)this.generatedCodeLine++,this.raw[this.generatedCodeLine]=this.rawSegments=[];this.generatedCodeColumn=0}this.generatedCodeColumn+=n[n.length-1].length}};var n="\n",warned={insertLeft:!1,insertRight:!1,storeName:!1},MagicString=function(t,n){void 0===n&&(n={});var e=new Chunk(0,t.length,t);Object.defineProperties(this,{original:{writable:!0,value:t},outro:{writable:!0,value:""},intro:{writable:!0,value:""},firstChunk:{writable:!0,value:e},lastChunk:{writable:!0,value:e},lastSearchedChunk:{writable:!0,value:e},byStart:{writable:!0,value:{}},byEnd:{writable:!0,value:{}},filename:{writable:!0,value:n.filename},indentExclusionRanges:{writable:!0,value:n.indentExclusionRanges},sourcemapLocations:{writable:!0,value:{}},storedNames:{writable:!0,value:{}},indentStr:{writable:!0,value:guessIndent(t)}}),this.byStart[0]=e,this.byEnd[t.length]=e};MagicString.prototype.addSourcemapLocation=function(t){this.sourcemapLocations[t]=!0},MagicString.prototype.append=function(t){if("string"!=typeof t)throw new TypeError("outro content must be a string");return this.outro+=t,this},MagicString.prototype.appendLeft=function(t,n){if("string"!=typeof n)throw new TypeError("inserted content must be a string");this._split(t);var e=this.byEnd[t];return e?e.appendLeft(n):this.intro+=n,this},MagicString.prototype.appendRight=function(t,n){if("string"!=typeof n)throw new TypeError("inserted content must be a string");this._split(t);var e=this.byStart[t];return e?e.appendRight(n):this.outro+=n,this},MagicString.prototype.clone=function(){for(var t=new MagicString(this.original,{filename:this.filename}),n=this.firstChunk,e=t.firstChunk=t.lastSearchedChunk=n.clone();n;){t.byStart[e.start]=e,t.byEnd[e.end]=e;var i=n.next,r=i&&i.clone();r&&(e.next=r,r.previous=e,e=r),n=i}return t.lastChunk=e,this.indentExclusionRanges&&(t.indentExclusionRanges=this.indentExclusionRanges.slice()),Object.keys(this.sourcemapLocations).forEach(function(n){t.sourcemapLocations[n]=!0}),t},MagicString.prototype.generateDecodedMap=function(t){var n=this;t=t||{};var e=Object.keys(this.storedNames),i=new Mappings(t.hires),r=getLocator(this.original);return this.intro&&i.advance(this.intro),this.firstChunk.eachNext(function(t){var o=r(t.start);t.intro.length&&i.advance(t.intro),t.edited?i.addEdit(0,t.content,o,t.storeName?e.indexOf(t.original):-1):i.addUneditedChunk(0,t,n.original,o,n.sourcemapLocations),t.outro.length&&i.advance(t.outro)}),{file:t.file?t.file.split(/[\/\\]/).pop():null,sources:[t.source?getRelativePath(t.file||"",t.source):null],sourcesContent:t.includeContent?[this.original]:[null],names:e,mappings:i.raw}},MagicString.prototype.generateMap=function(t){return new SourceMap(this.generateDecodedMap(t))},MagicString.prototype.getIndentString=function(){return null===this.indentStr?"\t":this.indentStr},MagicString.prototype.indent=function(t,n){var e=/^[^\r\n]/gm;if(isObject(t)&&(n=t,t=void 0),""===(t=void 0!==t?t:this.indentStr||"\t"))return this;var i={};(n=n||{}).exclude&&("number"==typeof n.exclude[0]?[n.exclude]:n.exclude).forEach(function(t){for(var n=t[0];n<t[1];n+=1)i[n]=!0});var r=!1!==n.indentStart,o=function(n){return r?""+t+n:(r=!0,n)};this.intro=this.intro.replace(e,o);for(var s=0,a=this.firstChunk;a;){var h=a.end;if(a.edited)i[s]||(a.content=a.content.replace(e,o),a.content.length&&(r="\n"===a.content[a.content.length-1]));else for(s=a.start;s<h;){if(!i[s]){var u=this.original[s];"\n"===u?r=!0:"\r"!==u&&r&&(r=!1,s===a.start?a.prependRight(t):(this._splitChunk(a,s),(a=a.next).prependRight(t)))}s+=1}s=a.end,a=a.next}return this.outro=this.outro.replace(e,o),this},MagicString.prototype.insert=function(){throw new Error("magicString.insert(...) is deprecated. Use prependRight(...) or appendLeft(...)")},MagicString.prototype.insertLeft=function(t,n){return warned.insertLeft||(console.warn("magicString.insertLeft(...) is deprecated. Use magicString.appendLeft(...) instead"),warned.insertLeft=!0),this.appendLeft(t,n)},MagicString.prototype.insertRight=function(t,n){return warned.insertRight||(console.warn("magicString.insertRight(...) is deprecated. Use magicString.prependRight(...) instead"),warned.insertRight=!0),this.prependRight(t,n)},MagicString.prototype.move=function(t,n,e){if(e>=t&&e<=n)throw new Error("Cannot move a selection inside itself");this._split(t),this._split(n),this._split(e);var i=this.byStart[t],r=this.byEnd[n],o=i.previous,s=r.next,a=this.byStart[e];if(!a&&r===this.lastChunk)return this;var h=a?a.previous:this.lastChunk;return o&&(o.next=s),s&&(s.previous=o),h&&(h.next=i),a&&(a.previous=r),i.previous||(this.firstChunk=r.next),r.next||(this.lastChunk=i.previous,this.lastChunk.next=null),i.previous=h,r.next=a||null,h||(this.firstChunk=i),a||(this.lastChunk=r),this},MagicString.prototype.overwrite=function(t,n,e,i){if("string"!=typeof e)throw new TypeError("replacement content must be a string");for(;t<0;)t+=this.original.length;for(;n<0;)n+=this.original.length;if(n>this.original.length)throw new Error("end is out of bounds");if(t===n)throw new Error("Cannot overwrite a zero-length range – use appendLeft or prependRight instead");this._split(t),this._split(n),!0===i&&(warned.storeName||(console.warn("The final argument to magicString.overwrite(...) should be an options object. See https://github.com/rich-harris/magic-string"),warned.storeName=!0),i={storeName:!0});var r=void 0!==i&&i.storeName,o=void 0!==i&&i.contentOnly;if(r){var s=this.original.slice(t,n);this.storedNames[s]=!0}var a=this.byStart[t],h=this.byEnd[n];if(a){if(n>a.end&&a.next!==this.byStart[a.end])throw new Error("Cannot overwrite across a split point");if(a.edit(e,r,o),a!==h){for(var u=a.next;u!==h;)u.edit("",!1),u=u.next;u.edit("",!1)}}else{var c=new Chunk(t,n,"").edit(e,r);h.next=c,c.previous=h}return this},MagicString.prototype.prepend=function(t){if("string"!=typeof t)throw new TypeError("outro content must be a string");return this.intro=t+this.intro,this},MagicString.prototype.prependLeft=function(t,n){if("string"!=typeof n)throw new TypeError("inserted content must be a string");this._split(t);var e=this.byEnd[t];return e?e.prependLeft(n):this.intro=n+this.intro,this},MagicString.prototype.prependRight=function(t,n){if("string"!=typeof n)throw new TypeError("inserted content must be a string");this._split(t);var e=this.byStart[t];return e?e.prependRight(n):this.outro=n+this.outro,this},MagicString.prototype.remove=function(t,n){for(;t<0;)t+=this.original.length;for(;n<0;)n+=this.original.length;if(t===n)return this;if(t<0||n>this.original.length)throw new Error("Character is out of bounds");if(t>n)throw new Error("end must be greater than start");this._split(t),this._split(n);for(var e=this.byStart[t];e;)e.intro="",e.outro="",e.edit(""),e=n>e.end?this.byStart[e.end]:null;return this},MagicString.prototype.lastChar=function(){if(this.outro.length)return this.outro[this.outro.length-1];var t=this.lastChunk;do{if(t.outro.length)return t.outro[t.outro.length-1];if(t.content.length)return t.content[t.content.length-1];if(t.intro.length)return t.intro[t.intro.length-1]}while(t=t.previous);return this.intro.length?this.intro[this.intro.length-1]:""},MagicString.prototype.lastLine=function(){var t=this.outro.lastIndexOf(n);if(-1!==t)return this.outro.substr(t+1);var e=this.outro,i=this.lastChunk;do{if(i.outro.length>0){if(-1!==(t=i.outro.lastIndexOf(n)))return i.outro.substr(t+1)+e;e=i.outro+e}if(i.content.length>0){if(-1!==(t=i.content.lastIndexOf(n)))return i.content.substr(t+1)+e;e=i.content+e}if(i.intro.length>0){if(-1!==(t=i.intro.lastIndexOf(n)))return i.intro.substr(t+1)+e;e=i.intro+e}}while(i=i.previous);return-1!==(t=this.intro.lastIndexOf(n))?this.intro.substr(t+1)+e:this.intro+e},MagicString.prototype.slice=function(t,n){for(void 0===t&&(t=0),void 0===n&&(n=this.original.length);t<0;)t+=this.original.length;for(;n<0;)n+=this.original.length;for(var e="",i=this.firstChunk;i&&(i.start>t||i.end<=t);){if(i.start<n&&i.end>=n)return e;i=i.next}if(i&&i.edited&&i.start!==t)throw new Error("Cannot use replaced character "+t+" as slice start anchor.");for(var r=i;i;){!i.intro||r===i&&i.start!==t||(e+=i.intro);var o=i.start<n&&i.end>=n;if(o&&i.edited&&i.end!==n)throw new Error("Cannot use replaced character "+n+" as slice end anchor.");var s=r===i?t-i.start:0,a=o?i.content.length+n-i.end:i.content.length;if(e+=i.content.slice(s,a),!i.outro||o&&i.end!==n||(e+=i.outro),o)break;i=i.next}return e},MagicString.prototype.snip=function(t,n){var e=this.clone();return e.remove(0,t),e.remove(n,e.original.length),e},MagicString.prototype._split=function(t){if(!this.byStart[t]&&!this.byEnd[t])for(var n=this.lastSearchedChunk,e=t>n.end;n;){if(n.contains(t))return this._splitChunk(n,t);n=e?this.byStart[n.end]:this.byEnd[n.start]}},MagicString.prototype._splitChunk=function(t,n){if(t.edited&&t.content.length){var e=getLocator(this.original)(n);throw new Error("Cannot split a chunk that has already been edited ("+e.line+":"+e.column+' – "'+t.original+'")')}var i=t.split(n);return this.byEnd[n]=t,this.byStart[n]=i,this.byEnd[i.end]=i,t===this.lastChunk&&(this.lastChunk=i),this.lastSearchedChunk=t,!0},MagicString.prototype.toString=function(){for(var t=this.intro,n=this.firstChunk;n;)t+=n.toString(),n=n.next;return t+this.outro},MagicString.prototype.isEmpty=function(){var t=this.firstChunk;do{if(t.intro.length&&t.intro.trim()||t.content.length&&t.content.trim()||t.outro.length&&t.outro.trim())return!1}while(t=t.next);return!0},MagicString.prototype.length=function(){var t=this.firstChunk,n=0;do{n+=t.intro.length+t.content.length+t.outro.length}while(t=t.next);return n},MagicString.prototype.trimLines=function(){return this.trim("[\\r\\n]")},MagicString.prototype.trim=function(t){return this.trimStart(t).trimEnd(t)},MagicString.prototype.trimEndAborted=function(t){var n=new RegExp((t||"\\s")+"+$");if(this.outro=this.outro.replace(n,""),this.outro.length)return!0;var e=this.lastChunk;do{var i=e.end,r=e.trimEnd(n);if(e.end!==i&&(this.lastChunk===e&&(this.lastChunk=e.next),this.byEnd[e.end]=e,this.byStart[e.next.start]=e.next,this.byEnd[e.next.end]=e.next),r)return!0;e=e.previous}while(e);return!1},MagicString.prototype.trimEnd=function(t){return this.trimEndAborted(t),this},MagicString.prototype.trimStartAborted=function(t){var n=new RegExp("^"+(t||"\\s")+"+");if(this.intro=this.intro.replace(n,""),this.intro.length)return!0;var e=this.firstChunk;do{var i=e.end,r=e.trimStart(n);if(e.end!==i&&(e===this.lastChunk&&(this.lastChunk=e.next),this.byEnd[e.end]=e,this.byStart[e.next.start]=e.next,this.byEnd[e.next.end]=e.next),r)return!0;e=e.next}while(e);return!1},MagicString.prototype.trimStart=function(t){return this.trimStartAborted(t),this};var hasOwnProp=Object.prototype.hasOwnProperty,Bundle=function(t){void 0===t&&(t={}),this.intro=t.intro||"",this.separator=void 0!==t.separator?t.separator:"\n",this.sources=[],this.uniqueSources=[],this.uniqueSourceIndexByFilename={}};Bundle.prototype.addSource=function(t){if(t instanceof MagicString)return this.addSource({content:t,filename:t.filename,separator:this.separator});if(!isObject(t)||!t.content)throw new Error("bundle.addSource() takes an object with a `content` property, which should be an instance of MagicString, and an optional `filename`");if(["filename","indentExclusionRanges","separator"].forEach(function(n){hasOwnProp.call(t,n)||(t[n]=t.content[n])}),void 0===t.separator&&(t.separator=this.separator),t.filename)if(hasOwnProp.call(this.uniqueSourceIndexByFilename,t.filename)){var n=this.uniqueSources[this.uniqueSourceIndexByFilename[t.filename]];if(t.content.original!==n.content)throw new Error("Illegal source: same filename ("+t.filename+"), different contents")}else this.uniqueSourceIndexByFilename[t.filename]=this.uniqueSources.length,this.uniqueSources.push({filename:t.filename,content:t.content.original});return this.sources.push(t),this},Bundle.prototype.append=function(t,n){return this.addSource({content:new MagicString(t),separator:n&&n.separator||""}),this},Bundle.prototype.clone=function(){var t=new Bundle({intro:this.intro,separator:this.separator});return this.sources.forEach(function(n){t.addSource({filename:n.filename,content:n.content.clone(),separator:n.separator})}),t},Bundle.prototype.generateDecodedMap=function(t){var n=this;void 0===t&&(t={});var e=[];this.sources.forEach(function(t){Object.keys(t.content.storedNames).forEach(function(t){~e.indexOf(t)||e.push(t)})});var i=new Mappings(t.hires);return this.intro&&i.advance(this.intro),this.sources.forEach(function(t,r){r>0&&i.advance(n.separator);var o=t.filename?n.uniqueSourceIndexByFilename[t.filename]:-1,s=t.content,a=getLocator(s.original);s.intro&&i.advance(s.intro),s.firstChunk.eachNext(function(n){var r=a(n.start);n.intro.length&&i.advance(n.intro),t.filename?n.edited?i.addEdit(o,n.content,r,n.storeName?e.indexOf(n.original):-1):i.addUneditedChunk(o,n,s.original,r,s.sourcemapLocations):i.advance(n.content),n.outro.length&&i.advance(n.outro)}),s.outro&&i.advance(s.outro)}),{file:t.file?t.file.split(/[\/\\]/).pop():null,sources:this.uniqueSources.map(function(n){return t.file?getRelativePath(t.file,n.filename):n.filename}),sourcesContent:this.uniqueSources.map(function(n){return t.includeContent?n.content:null}),names:e,mappings:i.raw}},Bundle.prototype.generateMap=function(t){return new SourceMap(this.generateDecodedMap(t))},Bundle.prototype.getIndentString=function(){var t={};return this.sources.forEach(function(n){var e=n.content.indentStr;null!==e&&(t[e]||(t[e]=0),t[e]+=1)}),Object.keys(t).sort(function(n,e){return t[n]-t[e]})[0]||"\t"},Bundle.prototype.indent=function(t){var n=this;if(arguments.length||(t=this.getIndentString()),""===t)return this;var e=!this.intro||"\n"===this.intro.slice(-1);return this.sources.forEach(function(i,r){var o=void 0!==i.separator?i.separator:n.separator,s=e||r>0&&/\r?\n$/.test(o);i.content.indent(t,{exclude:i.indentExclusionRanges,indentStart:s}),e="\n"===i.content.lastChar()}),this.intro&&(this.intro=t+this.intro.replace(/^[^\n]/gm,function(n,e){return e>0?t+n:n})),this},Bundle.prototype.prepend=function(t){return this.intro=t+this.intro,this},Bundle.prototype.toString=function(){var t=this,n=this.sources.map(function(n,e){var i=void 0!==n.separator?n.separator:t.separator;return(e>0?i:"")+n.content.toString()}).join("");return this.intro+n},Bundle.prototype.isEmpty=function(){return(!this.intro.length||!this.intro.trim())&&!this.sources.some(function(t){return!t.content.isEmpty()})},Bundle.prototype.length=function(){return this.sources.reduce(function(t,n){return t+n.content.length()},this.intro.length)},Bundle.prototype.trimLines=function(){return this.trim("[\\r\\n]")},Bundle.prototype.trim=function(t){return this.trimStart(t).trimEnd(t)},Bundle.prototype.trimStart=function(t){var n=new RegExp("^"+(t||"\\s")+"+");if(this.intro=this.intro.replace(n,""),!this.intro){var e,i=0;do{if(!(e=this.sources[i++]))break}while(!e.content.trimStartAborted(t))}return this},Bundle.prototype.trimEnd=function(t){var n,e=new RegExp((t||"\\s")+"+$"),i=this.sources.length-1;do{if(!(n=this.sources[i--])){this.intro=this.intro.replace(e,"");break}}while(!n.content.trimEndAborted(t));return this};export default MagicString;export{Bundle,SourceMap};
